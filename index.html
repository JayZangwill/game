<!DOCTYPE html>
<html lang="zh">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Document</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
				overflow: hidden;
			}
			
			html,
			body {
				width: 100%;
				height: 100%;
			}
		</style>
	</head>

	<body>
		<canvas id="canvas"></canvas>
		<script>
			(function(window, document) {
				const canvas = document.getElementById('canvas'),
					ctx = canvas.getContext('2d'),
					winWidth = document.body.clientWidth,
					winHeight = document.body.clientHeight,
					y1 = winHeight / 2 - 68, //68=图片高(48)+线位置(20)
					y2 = winHeight - 68,
					line1 = winHeight / 2 - 18,
					line2 = winHeight - 18;
				canvas.width = winWidth;
				canvas.height = winHeight;
				let p = new Promise((resolve, reject) => {
						let img = new Image();
						img.src = 'images/run.gif';
						img.onload = () => resolve(img);
						img.onerror = () => reject('img load error');
					}),
					dist = 20,
					jumping1 = false,
					jumping2 = false; //防止在跳跃过程中用户多次点击
				p.then((img) => {
					layout(img, line1, y1);
					layout(img, line2, y2);
					canvas.addEventListener('click', (e) => {
						if(e.clientY < line1 && !jumping1) {
							requestAnimationFrame(() => {
								jump(y1, y1, img, 1);
							})
						}
						if(e.clientY < line2 && e.clientY > line1 && !jumping2) {
							requestAnimationFrame(() => {
								jump(y2, y2, img, 2);
							})
						}
					})
				}).catch((e) => {
					console.error(e);
				});

				function layout(img, line, y) {
					ctx.beginPath();
					ctx.fillStyle = '#000';
					ctx.fillRect(0, line, winWidth, 10);
					ctx.drawImage(img, 50, y);
					ctx.closePath();
				}

				function jump(y, orgin, img, flag) {
					ctx.clearRect(50, y, 48, 48);
					if(y > orgin - 10 && dist !== 20) {
						//防止图片下落过头让图片归位
						y = orgin;
						ctx.drawImage(img, 50, y);
						dist = 20;
						if(flag === 1) {
							jumping1 = false;
						} else {
							jumping2 = false;
						}
					} else {
						if(flag === 1) {
							jumping1 = true;
						} else {
							jumping2 = true;
						}
						dist--;
						y -= dist;
						ctx.drawImage(img, 50, y);
						requestAnimationFrame(() => {
							jump(y, orgin, img, flag);
						})
					}
				}
			})(window, document);
		</script>
	</body>

</html>